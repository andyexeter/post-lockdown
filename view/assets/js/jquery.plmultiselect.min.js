!function(a,b){"use strict";function c(b,c){this.$el=a(b),this.options=a.extend({},a.fn[d].defaults,c),this.$search=this.options.inputSearch,this.$left=this.options.ulAvailable,this.$right=this.options.ulSelected,this.$spinner=this.options.spinner,this.doingAjax=!1,this.init()}var d="plmultiselect";c.prototype={init:function(){var c=this;a.widget("custom.plautocomplete",a.ui.autocomplete,{_renderMenu:function(a,b){c.renderMenu(c.$left,b)}}),a(b).load(a.proxy(function(){this.$right.height(this.$left.parent().height())},this)),this.$search.plautocomplete({source:function(a,b){c.queryItems(a.term,0,function(a){b(a.data)})},minLength:0}).plautocomplete("search"),this.$left.on("click","> li",function(){a(this).is(".selected")||c.selectItem.call(c,a(this))}),this.$right.on("click","> li .dashicons-no",function(){var b=a(this).closest("li").data("post_id");a(this).closest("li").remove(),c.$left.find(".post-"+b).removeClass("selected")}),this.options.selected.length&&this.selectItem(this.options.selected),this.$left.on("scroll",function(){this.scrollHeight-a(this).scrollTop()<=a(this).height()&&c.nextPage()})},destroy:function(){},emit:function(a){this.$el.trigger(d+"."+a,[this.options])},nextPage:function(){var b=this.options.inputSearch.val(),c=this.$left.children("li").length;this.queryItems(b,c,a.proxy(function(a){this.renderMenu(this.$left,a.data,"",!0)},this))},queryItems:function(c,d,e){return this.doingAjax?!1:(this.doingAjax=!0,this.$spinner.addClass("is-active"),void a.ajax({url:b.ajaxurl,type:"GET",data:{action:this.options.ajaxAction,term:c,offset:d},context:this,success:function(b){a.isFunction(e)&&e.call(this,b)},complete:function(){this.doingAjax=!1,this.$spinner.removeClass("is-active")}}))},selectItem:function(b){var c=this.options.inputName+"[]";a.isArray(b)?this.renderMenu(this.$right,b,c,!0):(b.clone(!1).data("post_id",b.data("post_id")).appendTo(this.$right).find("input.post-id").attr("name",c),b.addClass("selected"))},renderMenu:function(b,c,d,e){var f=this,g=[];e||b.empty(),a.each(c,function(a,b){g.push(f.getItemTpl(b,d))}),b.append(g)},getItemTpl:function(b,c){c||(c="");var d=a("<li />").addClass("post-"+b.ID).data("post_id",b.ID).append('<span class="post-title">'+b.post_title+'</span><span class="dashicons dashicons-no"></span><span class="post-type">'+b.post_type+'</span><input type="hidden" class="post-id" name="'+c+'" value="'+b.ID+'" />');return this.$right.find(".post-"+b.ID).length&&d.addClass("selected"),d}},a.fn[d]=function(){var b=arguments;return this.each(function(){var e=a(this).data(d+".plugin");e||(e=new c(this,b[0]),a(this).data(d+".plugin",e)),"string"==typeof b[0]&&"_"!==b[0].charAt(0)&&a.isFunction(e[b[0]])&&e[b[0]].apply(e,[].slice.call(b,1))})},a.fn[d].defaults={}}(jQuery,window);